<?xml version="1.0" encoding="utf-8"?>
<odoo>
   

    <template id = "invoice_extend_second_price" inherit_id = "sale.report_saleorder_document">
    
    <xpath expr = "//th[@name='th_taxes']" position= "replace"> 
        <th name="th_taxes" class="text-right">Prix avec installation</th>
    </xpath>
     <xpath expr = "//th[@name='th_subtotal']" position= "replace"> 
        
    </xpath>
    

     <xpath expr = "//td[@name='td_taxes']" position= "replace"> 
        
        <td t-if="price_with_installation == 0" class="text-right" groups="product.group_discount_per_so_line">
        <t t-set="current_subtotal_with_installation" t-value="current_subtotal_with_installation + line.list_price"/>
            <span t-field="line.list_price"/>
        </td>

        <td t-if="price_with_installation > 0" class="text-right" groups="product.group_discount_per_so_line">
            <t t-set="current_subtotal_with_installation" t-value="current_subtotal_with_installation + line.price_with_installation"/>
            <span t-field="line.price_with_installation"/>
        </td>
        
    </xpath>

    <xpath expr = "//div[@class='clearfix']" position= "after"> 
        <t t-set="current_subtotal_with_installation" t-value="0"/>
        <t t-foreach="doc.order_line" t-as="line">

            <t t-if="price_with_installation == 0">
                <t t-set="current_subtotal_with_installation" t-value="current_subtotal_with_installation + line.list_price"/>    
            </t>

            <t t-if="price_with_installation > 0">
                <t t-set="current_subtotal_with_installation" t-value="current_subtotal_with_installation + line.price_with_installation"/>
            </t>

        <div>
           <strong class="mr16">current_subtotal_with_installation</strong>
            <span t-esc="current_subtotal_with_installation" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: doc.pricelist_id.currency_id"/>
        </div>
    </xpath>

    </template>
</odoo>