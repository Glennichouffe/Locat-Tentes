<?xml version="1.0" encoding="utf-8"?>
<odoo>
   

    <template id = "invoice_extend_second_price" inherit_id = "sale.report_saleorder_document">
    
    <xpath expr = "//th[@name='th_taxes']" position= "replace"> 
        <th name="th_taxes" class="text-right">Prix unitaire avec installation</th>
    </xpath>
     <xpath expr = "//th[@name='th_subtotal']" position= "replace"> 
        
    </xpath>
    

     <xpath expr = "//td[@name='td_taxes']" position= "replace"> 

    </xpath>

    <xpath expr = "//td[@name='td_subtotal']" position= "replace"> 
        
        

        <td t-if="line.product_id.has_second_price" class="text-right">
            <span t-field="line.product_id.price_with_installation"/>
        </td>
        <td t-if="line.product_id.has_second_price == false" class="text-right">
            <span t-field="line.price_unit"/>
        </td>
        
    </xpath>
    <xpath expr = "//tr[@class='is-subtotal text-right']" position= "replace"> 
        <t t-set="current_subtotal_with_installation" t-value="0"/>
        <t t-set="current_subtotal" t-value="0"/>

        <t t-foreach="doc.order_line" t-as="line">

        <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
        <t t-set="current_subtotal" t-value="current_subtotal + line.price_total" groups="account.group_show_line_subtotals_tax_included"/>

        <t t-if="line.product_id.has_second_price == false">
            <t t-set="current_subtotal_with_installation" t-value="current_subtotal_with_installation + (line.price_unit * line.product_uom_qty)"/>    
        </t>

        <t t-if="line.product_id.has_second_price">
            <t t-set="current_subtotal_with_installation" t-value="current_subtotal_with_installation + (line.product_id.price_with_installation * line.product_uom_qty)"/>
        </t>
        </t>

        <tr class="is-subtotal text-right">
            <td name="td_section_subtotal" colspan="99">
                <strong class="mr16">Subtotal without installation</strong>
                <span t-esc="current_subtotal" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: doc.pricelist_id.currency_id}"/>

                <strong class="mr16">Subtotal with installation</strong>
                <span t-esc="current_subtotal_with_installation" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: doc.pricelist_id.currency_id}"/>
            </td>
        </tr>
    </xpath>

    </template>
</odoo>